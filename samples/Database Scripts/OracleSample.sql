CREATE OR REPLACE 
PACKAGE RW_PKG AS 

  TYPE CURSOR_TYPE IS REF CURSOR;

END RW_PKG;

/

CREATE OR REPLACE PROCEDURE GET_EMPLOYEES_BY_DEPT 
(
  P_DEPTNO IN EMP.DEPTNO%TYPE,
  P_RESULTSET OUT RW_PKG.CURSOR_TYPE
)
AS 
BEGIN
  OPEN P_RESULTSET FOR
  SELECT ENAME, EMPNO, DEPTNO
  FROM EMP
  WHERE DEPTNO = P_DEPTNO
  ORDER BY EMPNO;
END GET_EMPLOYEES_BY_DEPT;

/


SET SERVEROUTPUT ON SIZE 1000000

DECLARE 
  V_CURSOR RW_PKG.CURSOR_TYPE;
  V_ENAME  EMP.ENAME%TYPE;
  V_EMPNO  EMP.EMPNO%TYPE;
  V_DEPTNO EMP.DEPTNO%TYPE;
  
BEGIN
  GET_EMPLOYEES_BY_DEPT( P_DEPTNO => 30, P_RESULTSET => V_CURSOR);
  
  LOOP
    FETCH V_CURSOR
    INTO V_ENAME, V_EMPNO, V_DEPTNO;
    EXIT WHEN V_CURSOR%NOTFOUND;
    DBMS_OUTPUT.PUT_LINE(v_ename || ' | ' || v_empno || ' | ' || v_deptno);
  END LOOP;
  CLOSE V_CURSOR;
END;  
